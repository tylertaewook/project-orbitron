(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     50698,       1047]
NotebookOptionsPosition[     49292,       1011]
NotebookOutlinePosition[     49674,       1028]
CellTagsIndexPosition[     49631,       1025]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Master 4WD/4WS vehicle control algorithm v4", "Title",
 CellChangeTimes->{{3.759209968276164*^9, 3.75920998721935*^9}, {
  3.759210067947523*^9, 3.7592100682754445`*^9}, {3.76127294462773*^9, 
  3.7612729447415657`*^9}},ExpressionUUID->"7c9512d1-d4da-48ef-8c98-\
e1e558668319"],

Cell[CellGroupData[{

Cell["\<\
Initialize the positions and directions.  Reset the controller\
\>", "Subsubsection",
 CellChangeTimes->{{3.7602422427055483`*^9, 
  3.760242289525102*^9}},ExpressionUUID->"e289b838-1f19-4e70-b73d-\
f36ad49c95d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "In", " ", "order", " ", "to", " ", "avoid", " ", "dividing", " ", "by", 
     " ", "zero"}], ",", " ", 
    RowBox[{
     RowBox[{"a", " ", "zeroRange", " ", "was", " ", 
      RowBox[{"defined", ".", "  ", "Any"}], " ", "number", " ", "that", " ", 
      "falls", " ", "between"}], " ", "-", 
     RowBox[{"zeoRange", " ", "and"}], " ", "+", 
     RowBox[{"zeroRange", " ", "will", " ", "be", " ", "calculated", " ", 
      RowBox[{"separately", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"zeroRange", "=", "0.00001"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"This", " ", "is", " ", "to", " ", "reset", " ", "the", " ", 
      RowBox[{"controller", ".", "  ", "When"}], " ", "this", " ", "line", 
      " ", "is", " ", "run"}], ",", " ", 
     RowBox[{
     "the", " ", "rest", " ", "of", " ", "program", " ", "acts", " ", "as", 
      " ", "if", " ", "the", " ", "controller", " ", "was", " ", "pulled", 
      " ", "out", " ", "then", " ", "plugged", " ", "back", " ", 
      RowBox[{"in", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "y1", ",", "z1", ",", "x2", ",", "y2", ",", "z2"}], 
      "}"}], "=", 
     RowBox[{"latest", "=", 
      RowBox[{"ControllerState", "[", 
       RowBox[{"\"\<SpaceNavigator\>\"", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<X1\>\"", ",", "\"\<Y1\>\"", ",", "\"\<Z1\>\"", ",", 
          "\"\<X2\>\"", ",", "\"\<Y2\>\"", ",", "\"\<Z2\>\""}], "}"}]}], 
       "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"If", " ", "z2", " ", "is", " ", "really", " ", "zero"}], ",", 
     " ", 
     RowBox[{
     "then", " ", "the", " ", "car", " ", "does", " ", "not", " ", "show", 
      " ", "the", " ", "arrows", " ", "because", " ", "the", " ", "routine", 
      " ", "assume", " ", "it", " ", "is", " ", "on", " ", "a", " ", 
      "curvature", " ", "of", " ", "some", " ", 
      RowBox[{"sort", ".", "  ", "So"}]}], ",", " ", 
     RowBox[{
     "create", " ", "a", " ", "very", " ", "slight", " ", "rotation", " ", 
      "so", " ", "that", " ", "the", " ", "arrows", " ", "show", " ", 
      RowBox[{"up", ".", "  ", "Without"}], " ", "this", " ", "line"}], ",", 
     " ", 
     RowBox[{
     "there", " ", "are", " ", "not", " ", "arrows", " ", "until", " ", "the",
       " ", "controller", " ", "experiences", " ", "some", " ", 
      RowBox[{"rotation", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"latest", "[", 
      RowBox[{"[", 
       RowBox[{"-", "1"}], "]"}], "]"}], "+=", 
     RowBox[{"zeroRange", "/", "100"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "create", " ", "a", " ", "routine", " ", "to", " ", "store", " ", "last", 
     " ", "ten", " ", "positions"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"posBodyHistory", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x1", ",", "x2"}], "}"}], ",", "10"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "default", " ", "initial", " ", "direction", " ", "of", " ", "movement", 
     " ", "of", " ", "the", " ", "body"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dirBody", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1."}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "default", " ", "last", " ", "direction", " ", "of", " ", "movement", 
      " ", "of", " ", "the", " ", 
      RowBox[{"body", ".", "  ", "Last"}], " ", "direction", " ", "is", " ", 
      "important", " ", "because", " ", "if", " ", "the", " ", "car", " ", 
      RowBox[{"didn", "'"}], "t", " ", "move", " ", "between", " ", "two", 
      " ", "Dynamic"}], ",", " ", 
     RowBox[{
     "then", " ", "the", " ", "newly", " ", "calculated", " ", "direction", 
      " ", "would", " ", "result", " ", "in", " ", "no", " ", 
      RowBox[{"direction", ".", "  ", "In"}], " ", "that", " ", "case"}], ",",
      " ", 
     RowBox[{
     "the", " ", "old", " ", "direction", " ", "has", " ", "to", " ", "be", 
      " ", "used", " ", "to", " ", "poin", " ", "the", " ", "car", " ", "to", 
      " ", "the", " ", "direction", " ", "it", " ", "was", " ", "pointing", 
      " ", 
      RowBox[{"to", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dirBodyLast", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1."}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"The", " ", "direction", " ", "of", " ", "the", " ", 
      RowBox[{"body", "'"}], "s", " ", "movement", " ", "and", " ", "how", 
      " ", "the", " ", "car", " ", "is", " ", "rotated", " ", "are", " ", 
      "two", " ", "seperate", " ", "matters", " ", "in", " ", "4", 
      RowBox[{"WD", "/", "4"}], 
      RowBox[{"WS", ".", " ", "rotBody"}], " ", "is", " ", "where", " ", 
      "the", " ", 
      RowBox[{"car", "'"}], "s", " ", "front", " ", "is", " ", "pointing", 
      " ", "to"}], ",", " ", 
     RowBox[{"not", " ", "where", " ", "it", " ", "is", " ", "heading", " ", 
      RowBox[{"to", ".", "  ", "Zero"}], " ", "is", " ", 
      RowBox[{"north", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rotBody", "=", "0."}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"The", " ", 
      RowBox[{"controller", "'"}], "s", " ", "reading", " ", "is", " ", "so", 
      " ", "low", " ", "that", " ", "they", " ", "have", " ", "to", " ", "be",
       " ", 
      RowBox[{"boosted", ".", "  ", "Since"}], " ", "translation", " ", "and",
       " ", "rotation", " ", "produces", " ", "different", " ", "scale", " ", 
      "of", " ", "numbers"}], ",", " ", 
     RowBox[{
     "or", " ", "they", " ", "are", " ", "used", " ", "different", " ", "on", 
      " ", "the", " ", "program"}], ",", " ", 
     RowBox[{"they", " ", "require", " ", "different", " ", "boost", " ", 
      RowBox[{"factors", ".", "  ", "Notice"}], " ", "that", " ", "0.5", " ", 
      "was", " ", "to", " ", "used", " ", "to", " ", "make", " ", "the", " ", 
      "rotation", " ", "not", " ", "so", " ", 
      RowBox[{"sensitive", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"factor", "=", 
     RowBox[{"100000", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2", ",", "2", ",", "1", ",", "1", ",", ".5"}], 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Where", " ", "the", " ", "car", " ", "was", " ", "located", " ", 
     "initially"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"posBody", "=", 
     RowBox[{"{", 
      RowBox[{"x1", ",", "y1"}], "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.759210556478448*^9, 3.759210708252303*^9}, {
   3.7592107444980464`*^9, 3.759210763644208*^9}, {3.7592108334213753`*^9, 
   3.759210833697583*^9}, 3.7592109751863513`*^9, {3.759211166780079*^9, 
   3.7592111939792356`*^9}, {3.759211307656867*^9, 3.759211427077297*^9}, {
   3.7592115784461145`*^9, 3.7592116358281317`*^9}, {3.759223908158055*^9, 
   3.759223950699969*^9}, {3.7592300246137047`*^9, 3.759230042043106*^9}, {
   3.7592301403321657`*^9, 3.7592301877726107`*^9}, {3.759230431709218*^9, 
   3.7592304392283115`*^9}, {3.759230476356307*^9, 3.7592304807717314`*^9}, {
   3.759231017708313*^9, 3.759231022413861*^9}, {3.7592343395564404`*^9, 
   3.7592343676189933`*^9}, {3.759234443397047*^9, 3.7592344607716827`*^9}, {
   3.759234950556573*^9, 3.7592350265874453`*^9}, {3.7592350676443434`*^9, 
   3.759235104651331*^9}, {3.759235479628928*^9, 3.7592354839954596`*^9}, {
   3.759235868061096*^9, 3.759235882972619*^9}, {3.759235918332074*^9, 
   3.7592360209470263`*^9}, {3.759236060846434*^9, 3.7592360810543427`*^9}, {
   3.7592362017367296`*^9, 3.759236264403895*^9}, {3.759236348957012*^9, 
   3.7592365596644745`*^9}, {3.759237172119695*^9, 3.75923718328622*^9}, {
   3.759237383108845*^9, 3.759237387957286*^9}, {3.759238055209771*^9, 
   3.7592380612829547`*^9}, 3.7592398682164564`*^9, {3.7592402531320963`*^9, 
   3.7592403318356824`*^9}, {3.75924036824971*^9, 3.759240369748886*^9}, {
   3.75924043990628*^9, 3.7592404483367662`*^9}, 3.7592404928433313`*^9, {
   3.759240563768467*^9, 3.759240564237058*^9}, {3.7592408568064747`*^9, 
   3.759240880564267*^9}, {3.7592409579269075`*^9, 3.75924099446249*^9}, {
   3.7592411318928237`*^9, 3.7592411322608027`*^9}, {3.759241238118441*^9, 
   3.7592412449873824`*^9}, {3.7592415193678093`*^9, 
   3.7592416721745787`*^9}, {3.7592417636483107`*^9, 3.759241767307543*^9}, {
   3.759241849480682*^9, 3.7592418508072824`*^9}, {3.7592418974320116`*^9, 
   3.7592419927493873`*^9}, {3.7592420255378695`*^9, 
   3.7592420293989215`*^9}, {3.7592420681753683`*^9, 
   3.7592420861176443`*^9}, {3.7592432686953244`*^9, 3.7592433123723016`*^9}, 
   3.75924340873435*^9, {3.7592439980256433`*^9, 3.7592439992270103`*^9}, {
   3.759244052219767*^9, 3.7592440733138533`*^9}, {3.7592445060049286`*^9, 
   3.7592445206634135`*^9}, {3.7592453443035316`*^9, 3.759245482235781*^9}, 
   3.759323809949156*^9, {3.7593239220946198`*^9, 3.7593239440731897`*^9}, {
   3.7593242228367186`*^9, 3.7593242604430203`*^9}, {3.7593772373313065`*^9, 
   3.759377262023157*^9}, {3.759378073562419*^9, 3.7593780920644503`*^9}, {
   3.759378164822348*^9, 3.7593781664483385`*^9}, {3.759380393770523*^9, 
   3.75938042998403*^9}, 3.759381220318223*^9, {3.759383316171155*^9, 
   3.7593833488212724`*^9}, 3.759383465438633*^9, {3.7593845122150974`*^9, 
   3.759384669908424*^9}, {3.7593847245009837`*^9, 3.7593848300495253`*^9}, {
   3.759384863868933*^9, 3.759384867044836*^9}, {3.759384905591957*^9, 
   3.759385044941331*^9}, 3.759385089344422*^9, {3.7593851452838926`*^9, 
   3.759385148560294*^9}, {3.75938629113869*^9, 3.7593863418126106`*^9}, {
   3.7593864711500664`*^9, 3.759386482934337*^9}, {3.7593865638965*^9, 
   3.7593866705753493`*^9}, {3.759386722746483*^9, 3.759386740839574*^9}, 
   3.759387392750205*^9, 3.759387549964859*^9, {3.759387773607343*^9, 
   3.7593877934467893`*^9}, {3.7593879049733143`*^9, 3.759387913958396*^9}, {
   3.7593881886920443`*^9, 3.7593882112200756`*^9}, {3.7593978245230565`*^9, 
   3.7593978581589413`*^9}, {3.7593979039108944`*^9, 
   3.7593979297563496`*^9}, {3.7593980414976225`*^9, 
   3.7593980420090466`*^9}, {3.7594018324637394`*^9, 3.7594018687348256`*^9}, 
   3.759402501089511*^9, {3.759402628630288*^9, 3.7594026782374673`*^9}, {
   3.759402732729473*^9, 3.759402734159338*^9}, {3.7594028631123357`*^9, 
   3.7594028678527884`*^9}, {3.7594034346408415`*^9, 
   3.7594034397872744`*^9}, {3.759403528517415*^9, 3.7594035583439755`*^9}, {
   3.759404479626338*^9, 3.759404483401533*^9}, {3.7594045330642896`*^9, 
   3.7594045654235907`*^9}, {3.7594046838416734`*^9, 
   3.7594046852744193`*^9}, {3.7594048078522096`*^9, 
   3.7594048339875865`*^9}, {3.7594048717928977`*^9, 3.759404884258397*^9}, {
   3.759404963275344*^9, 3.7594049772302046`*^9}, {3.7594062126944876`*^9, 
   3.7594062325912304`*^9}, {3.7594064980593023`*^9, 3.759406538830751*^9}, 
   3.7594066031530285`*^9, {3.7594070282581654`*^9, 3.7594070412194448`*^9}, {
   3.759407504202648*^9, 3.7594075250509834`*^9}, {3.759407620994693*^9, 
   3.7594078044885163`*^9}, {3.7594078859649754`*^9, 3.759407953492075*^9}, 
   3.7594080113493395`*^9, {3.759408052772727*^9, 3.7594080594144163`*^9}, {
   3.7594081451843114`*^9, 3.75940815037956*^9}, {3.7602414004976373`*^9, 
   3.7602414539374313`*^9}, {3.7602421096692305`*^9, 3.7602421166417837`*^9}, 
   3.7602422322594156`*^9, {3.7602424438732758`*^9, 3.760242571839257*^9}, {
   3.7602426210246572`*^9, 3.7602426739305625`*^9}, {3.7602427044031878`*^9, 
   3.7602430965658507`*^9}, 3.7602449862313814`*^9, {3.760245035249361*^9, 
   3.7602450359179487`*^9}, {3.7602661722523623`*^9, 3.7602661914219294`*^9}},
 CellLabel->
  "In[232]:=",ExpressionUUID->"943c82f4-b51b-42dd-8f4a-d6bf64d720a1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["This is the main routine that loop through", "Subsubsection",
 CellChangeTimes->{{3.760242248750849*^9, 
  3.7602422572469378`*^9}},ExpressionUUID->"6f7be653-ad4b-43a1-be94-\
08955238cb1f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "[", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "read", " ", "in", " ", "the", " ", "fresh", " ", "input", " ", "from", 
     " ", "the", " ", "space", " ", "mouse"}], ",", " ", 
    RowBox[{
    "subtract", " ", "the", " ", "\"\<latest\>\"", " ", "to", " ", "get", " ",
      "only", " ", "the", " ", "values", " ", "that", " ", "changed", " ", 
     "since", " ", "the", " ", 
     RowBox[{"\"\<latest\>\"", ".", "  ", "Then"}], " ", "multiply", " ", 
     "by", " ", "the", " ", "factor", " ", "to", " ", "adjust", " ", "the", 
     " ", "sensitivities", " ", "of", " ", "each", " ", "degree", " ", "of", 
     " ", 
     RowBox[{"freedom", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x1", ",", "y1", ",", "z1", ",", "x2", ",", "y2", ",", "z2"}], 
     "}"}], "=", 
    RowBox[{"factor", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"ControllerState", "[", 
        RowBox[{"\"\<SpaceNavigator\>\"", ",", 
         RowBox[{"{", 
          RowBox[{
          "\"\<X1\>\"", ",", "\"\<Y1\>\"", ",", "\"\<Z1\>\"", ",", 
           "\"\<X2\>\"", ",", "\"\<Y2\>\"", ",", "\"\<Z2\>\""}], "}"}]}], 
        "]"}], "-", "latest"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "read", " ", "the", " ", "buttons", " ", "to", " ", "be", " ", "used", 
     " ", "in", " ", "case", " ", "there", " ", "is", " ", "a", " ", 
     "rotation"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"b1", ",", "b2"}], "}"}], "=", 
    RowBox[{"ControllerState", "[", 
     RowBox[{"\"\<SpaceNavigator\>\"", ",", 
      RowBox[{"{", 
       RowBox[{"\"\<B1\>\"", ",", "\"\<B2\>\""}], "}"}]}], "]"}]}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "to", " ", "collect", " ", "last", " ", "ten", 
      " ", 
      RowBox[{"inputs", ".", "  ", "posBodyHistory"}], " ", "stores", " ", 
      "the", " ", "lat", " ", 
      RowBox[{"readings", ".", "  ", "RotateRight"}], " ", "moves", " ", 
      "all", " ", "the", " ", "numbers", " ", "to", " ", "the", " ", 
      "right"}], ",", " ", 
     RowBox[{
     "shifting", " ", "them", " ", "to", " ", "the", " ", "past", " ", "by", 
      " ", "one", " ", 
      RowBox[{"step", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"posBodyHistory", "=", 
    RowBox[{"RotateRight", "[", "posBodyHistory", "]"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "then", " ", "it", " ", "fills", " ", "the", " ", "most", " ", "recent", 
     " ", "spot", " ", "with", " ", "the", " ", "latest", " ", "data"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"posBodyHistory", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"x1", ",", "y1"}], "}"}]}], ";", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Now", " ", "the", " ", "vehicle", " ", "has", " ", "to", " ", "travel", 
     " ", "along", " ", "the", " ", 
     RowBox[{"circle", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Check", " ", "how", " ", "long", " ", "it", " ", "moved", " ", "in", 
      " ", "x", " ", "and", " ", "y", " ", 
      RowBox[{"direction", ".", "  ", "The"}], " ", "x1", " ", "and", " ", 
      "y1", " ", "is", " ", "the", " ", "reading", " ", "of", " ", "the", " ", 
      RowBox[{"spacemouse", ".", "  ", "The"}], " ", 
      RowBox[{"mouse", "'"}], "s", " ", "direction", " ", "agrees", " ", 
      "with", " ", "the", " ", "vehicle", " ", "only", " ", "when", " ", 
      "the", " ", "car", " ", "is", " ", "facing", " ", 
      RowBox[{"north", ".", "  ", "Other"}], " ", "times"}], ",", " ", 
     RowBox[{
     "the", " ", "intended", " ", "direction", " ", "such", " ", "a", " ", 
      "forward"}], ",", " ", 
     RowBox[{
     "given", " ", "by", " ", "the", " ", "driver", " ", "has", " ", "to", 
      " ", "be", " ", "translated", " ", "as", " ", "the", " ", "direction", 
      " ", "on", " ", "the", " ", "simulation", " ", "by", " ", "rotating", 
      " ", 
      RowBox[{"it", ".", "  ", "This"}], " ", "step", " ", "is", " ", 
      "necessary", " ", "only", " ", "in", " ", "the", " ", 
      RowBox[{"screen", ".", "  ", "The"}], " ", "actual", " ", "vehicle", 
      " ", "should", " ", "not", " ", "do", " ", 
      RowBox[{"this", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dx", ",", "dy"}], "}"}], "=", 
    RowBox[{
     RowBox[{"RotationTransform", "[", "rotBody", "]"}], "[", 
     RowBox[{
      RowBox[{"posBodyHistory", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "-", 
      RowBox[{"posBodyHistory", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Find", " ", "out", " ", "how", " ", "far", " ", "it", " ", "traveled", 
     " ", "by", " ", "finding", " ", "the", " ", "hypothenuse"}], " ", "*)"}],
    "\[IndentingNewLine]", 
   RowBox[{"distance", "=", 
    RowBox[{"Norm", "[", 
     RowBox[{"{", 
      RowBox[{"dx", ",", "dy"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Find", " ", "out", " ", "the", " ", "radius", " ", "of", " ", 
     "curvature", " ", "of", " ", "the", " ", "motion", " ", "so", " ", 
     "that", " ", "the", " ", 
     RowBox[{"car", "'"}], "s", " ", "trajectory", " ", "along", " ", "that", 
     " ", "circle", " ", "can", " ", "be", " ", 
     RowBox[{"calculated", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"bodyRadius", "=", 
    RowBox[{"Norm", "[", "posCurveCenter", "]"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "now", " ", "that", " ", "we", " ", "know", " ", "how", " ", "much", " ", 
     "it", " ", "moved", " ", "since", " ", "last", " ", "time", " ", 
     "\"\<distance\>\"", " ", "and", " ", "the", " ", "radius", " ", "of", 
     " ", "the", " ", "circle", " ", "\"\<bodyRadius\>\"", " ", "we", " ", 
     "can", " ", "calculate", " ", "how", " ", "many", " ", "radians", " ", 
     "that", " ", "motion", " ", "is", " ", "on", " ", "the", " ", 
     RowBox[{"circle", ".", "  ", "This"}], " ", "is", " ", "necessary", " ", 
     "because", " ", "we", " ", "cannot", " ", "let", " ", "the", " ", 
     "vehicle", " ", "move", " ", 
     RowBox[{"straight", ".", "  ", "We"}], " ", "need", " ", "to", " ", 
     "make", " ", "it", " ", "follow", " ", "the", " ", "circle", " ", 
     "because", " ", "it", " ", "has", " ", "to", " ", "follow", " ", "the", 
     " ", "radius", " ", "of", " ", "curvature"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"dTheta", "=", 
    RowBox[{
     RowBox[{"Sign", "[", "z2", "]"}], 
     RowBox[{"distance", "/", "bodyRadius"}]}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "find", " ", "out", " ", "at", " ", "what", " ", "angle", " ", "the", " ",
      "center", " ", "of", " ", "the", " ", "vehicle", " ", "is", " ", 
     "relative", " ", "to", " ", "the", " ", "center", " ", "of", " ", 
     RowBox[{"curvature", ".", "  ", "Or"}], " ", "find", " ", "out", " ", 
     "at", " ", "what", " ", "angle", "  ", "the", " ", "center", " ", "of", 
     " ", "curvature", " ", "is", " ", "relative", " ", "to", " ", "the", " ", 
     RowBox[{"vehicle", "'"}], "s", " ", 
     RowBox[{"center", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"theta", "=", 
    RowBox[{"ArcTan", "@@", "posCurveCenter"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "now", " ", "the", " ", "car", " ", "moves", " ", "along", " ", "the", 
     " ", "circle", " ", "by", " ", "moving", " ", "tangential", " ", "to", 
     " ", "the", " ", "circle", " ", "of", " ", 
     RowBox[{"curvature", ".", "  ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Sin", "[", "theta", "]"}]}], ",", 
        RowBox[{"Cos", "[", "theta", "]"}]}], "}"}]}], " ", "is", " ", "the", 
     " ", "perpendicular", " ", "direction", " ", "to", " ", "a", " ", 
     "circle", " ", "that", " ", "is", " ", "drawn", " ", "with", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Cos", "[", "theta", "]"}], ",", 
       RowBox[{"Sin", "[", "theta", "]"}]}], "}"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"posBody", "+=", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"Sign", "[", "z2", "]"}]}], "distance", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"Sin", "[", "theta", "]"}]}], ",", 
       RowBox[{"Cos", "[", "theta", "]"}]}], "}"}]}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Since", " ", "the", " ", "vehicle", " ", "is", " ", "going", " ", 
      "around", " ", "a", " ", "circular", " ", "path"}], ",", " ", 
     RowBox[{
     "the", " ", "vehicle", " ", "would", " ", "appear", " ", "to", " ", "be",
       " ", "spinning", " ", "when", " ", "seen", " ", "from", " ", "the", 
      " ", "top"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"rotBody", "+=", "dTheta"}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"if", " ", "b1", " ", "is", " ", "pressed"}], ",", " ", 
     RowBox[{"then", " ", "spin", " ", 
      RowBox[{"left", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{"b1", ",", 
     RowBox[{
      RowBox[{"rotBody", "+=", "0.05"}], ";"}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"if", " ", "b1", " ", "is", " ", "pressed"}], ",", " ", 
     RowBox[{"then", " ", "spion", " ", "right"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{"b2", ",", 
     RowBox[{
      RowBox[{"rotBody", "-=", "0.05"}], ";"}]}], "]"}], ";", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "if", " ", "the", " ", "spacemouse", " ", "was", " ", "not", " ", 
      "touched"}], ",", " ", 
     RowBox[{
     "which", " ", "is", " ", "detected", " ", "by", " ", "the", " ", "size", 
      " ", "of", " ", "the", " ", "disatnce"}], ",", " ", 
     RowBox[{
     "then", " ", "keep", " ", "the", " ", "last", " ", "position"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"distance", "<", "0.01"}], ",", 
     RowBox[{"dirBody", "=", "dirBodyLast"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "but", " ", "if", " ", "it", " ", "was", " ", "touched", " ", "then", 
       " ", "the", " ", "direction", " ", "becomes", " ", 
       RowBox[{"{", 
        RowBox[{"dx", ",", " ", "dy"}], "}"}], " ", "and", " ", "the", " ", 
       "last", " ", "direction", " ", "is", " ", "also", " ", "stored", " ", 
       "as", " ", 
       RowBox[{"{", 
        RowBox[{"dx", ",", " ", "dy"}], "}"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"dirBody", "=", 
      RowBox[{"dirBodyLast", "=", 
       RowBox[{"{", 
        RowBox[{"dx", ",", "dy"}], "}"}]}]}]}], "]"}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"adjust", " ", "which", " ", "direction"}], "  ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"rotBodyDirectionAngle", "=", 
    RowBox[{
     RowBox[{"ArcTan", "@@", "dirBody"}], "+", 
     RowBox[{"Pi", "/", "2"}], "+", "Pi"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "this", " ", "is", " ", "where", " ", "the", " ", "center", " ", "of", 
     " ", "circular", " ", "path", " ", 
     RowBox[{"is", ".", "  ", "This"}], " ", "is", " ", "computed", " ", 
     "only", " ", "when", " ", "there", " ", "is", " ", "any", " ", "z2", " ", 
     RowBox[{"rotation", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"posCurveCenter", "=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "zeroRange"}], "<", "z2", "<", "zeroRange"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"if", " ", "z2", " ", "was", " ", "too", " ", "small"}], ",", 
        " ", 
        RowBox[{
        "then", " ", "just", " ", "assume", " ", "that", " ", "the", " ", 
         "center", " ", "of", " ", "the", " ", "circular", " ", "path", " ", 
         "is", " ", "10000", " ", "units", " ", "away", " ", "to", " ", "the",
          " ", "right"}], ",", " ", 
        RowBox[{
        "the", " ", "rotate", " ", "it", " ", "for", " ", "the", " ", "case", 
         " ", "when", " ", "it", " ", "is", " ", "not", " ", "directly", " ", 
         "on", " ", "the", " ", "side", " ", "of", " ", "the", " ", 
         RowBox[{"vehicle", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"RotationTransform", "[", 
        RowBox[{"rotBodyDirectionAngle", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], "]"}], "[", 
       RowBox[{"{", 
        RowBox[{"10000", ",", "0"}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "if", " ", "z2", " ", "value", " ", "was", " ", "not", " ", "near", 
         " ", "zero"}], ",", " ", 
        RowBox[{
        "then", " ", "calculate", " ", "the", " ", "center", " ", "of", " ", 
         "circular", " ", "path"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"RotationTransform", "[", 
        RowBox[{"rotBodyDirectionAngle", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], "]"}], "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "1"}], "/", "z2"}], ",", "0"}], "}"}], "]"}]}], 
     "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "now", " ", "comes", " ", "actual", " ", "painting", " ", "of", " ", 
     "the", " ", "simulation"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Column", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Row", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Button", "[", 
           RowBox[{"\"\<Start Recording\>\"", ",", 
            RowBox[{
             RowBox[{"startTime", "=", 
              RowBox[{"AbsoluteTime", "[", "]"}]}], ";", 
             RowBox[{"recordMoves", "=", "True"}], ";", 
             RowBox[{"fname", "=", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", 
                 "\"\<testfile.csv\>\""}], "}"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"stream", "=", 
              RowBox[{"OpenWrite", "[", "fname", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"WriteString", "[", 
              RowBox[{
              "stream", ",", 
               "\"\<Time, Center Speed, Front Right Speed, Back Right Speed, \
Front Left Speed, Back Left Speed, Front Right Angle,\n\tBack Right Angle, \
Front Left Angle, Back Left Angle\\n\>\""}], "]"}], ";"}]}], "]"}], ",", 
          RowBox[{"Button", "[", 
           RowBox[{"\"\<Stop and Save\>\"", ",", 
            RowBox[{
             RowBox[{"recordMoves", "=", "False"}], ";", 
             RowBox[{"Close", "[", "stream", "]"}]}]}], "]"}]}], "}"}], "]"}],
        ",", 
       RowBox[{"Graphics", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Draw", " ", "the", " ", 
             RowBox[{"body", ".", "comCar"}], " ", "needs", " ", "to", " ", 
             "know", " ", "where", " ", "the", " ", "center", " ", "of", " ", 
             "the", " ", "body", " ", "is"}], ",", 
            RowBox[{
            "and", " ", "what", " ", "the", " ", "rotation", " ", "is"}]}], 
           "*)"}], 
          RowBox[{
           RowBox[{"comCar", "[", 
            RowBox[{"posBody", ",", "rotBody"}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Draw", " ", "the", " ", 
              RowBox[{"wheels", ".", "It"}], " ", "needs", " ", "to", " ", 
              "know", " ", "where", " ", "the", " ", "body", " ", "is"}], ",", 
             RowBox[{
             "how", " ", "rotated", " ", "the", " ", "body", " ", "is"}], ",", 
             RowBox[{
             "and", " ", "where", " ", "the", " ", "center", " ", "of", " ", 
              "circular", " ", "path", " ", "is", " ", "because", " ", "the", 
              " ", "wheels", " ", "will", " ", "align", " ", "in", " ", "the",
               " ", "tanglential", " ", "direction", " ", "to", " ", "that", 
              " ", "circular", " ", "path"}]}], "*)"}], 
           RowBox[{"comWheels", "[", 
            RowBox[{"posBody", ",", "rotBody", ",", 
             RowBox[{"If", "[", 
              RowBox[{"b1", ",", 
               RowBox[{
                RowBox[{"-", "0.001"}], "posCurveCenter"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{"b2", ",", 
                 RowBox[{"0.001", "posCurveCenter"}], ",", "posCurveCenter"}],
                 "]"}]}], "]"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "The", " ", "command", " ", "below", " ", "is", " ", "to", " ", 
             "draw", " ", "the", " ", "lables", " ", "for", " ", "each", " ", 
             RowBox[{"wheel", "."}]}], "*)"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"comWheelLabels", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"x1", ",", "y1"}], "}"}], ",", "rotBody"}], "]"}], 
             ","}], "*)"}], 
           RowBox[{"(*", 
            RowBox[{
            "Draw", " ", "the", " ", "trajectory", " ", "which", " ", "are", 
             " ", "all", " ", 
             RowBox[{"circles", ".", "Even"}], " ", "straight", " ", "lines", 
             " ", "are", " ", "circles", " ", "with", " ", "very", " ", 
             "large", " ", 
             RowBox[{"radii", "."}]}], "*)"}], 
           RowBox[{"comDrawCircles", "[", 
            RowBox[{"posBody", ",", "rotBody", ",", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "if", " ", "button", " ", "1", " ", "is", " ", "pressed"}], 
               ",", 
               RowBox[{
               "then", " ", "assume", " ", "that", " ", "the", " ", "center", 
                " ", "of", " ", "the", " ", "circle", " ", "is", " ", 
                "almost", " ", "at", " ", "the", " ", "center", " ", "of", 
                " ", "the", " ", "body", " ", "of", " ", "the", " ", 
                "vehicle", " ", "but", " ", "not", " ", 
                RowBox[{"quite", ".", "It"}], " ", "is", " ", "at", " ", 
                "0.001", " ", "radius", " ", "from", " ", "the", " ", 
                "center", " ", "to", " ", "preserve", " ", "the", " ", 
                "direction", " ", "of", " ", "rotation"}]}], "*)"}], 
             RowBox[{"If", "[", 
              RowBox[{"b1", ",", 
               RowBox[{
                RowBox[{"-", "0.001"}], "posCurveCenter"}], ",", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"On", " ", "the", " ", "other", " ", "hand"}], ",", 
                 RowBox[{
                 "if", " ", "button", " ", "2", " ", "is", " ", "pressed", 
                  " ", "then", " ", "it", " ", "should", " ", "spin", " ", 
                  "right"}]}], "*)"}], 
               RowBox[{"If", "[", 
                RowBox[{"b2", ",", 
                 RowBox[{"0.001", "posCurveCenter"}], ",", "posCurveCenter"}],
                 "]"}]}], "]"}]}], "]"}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "Finally", " ", "compute", " ", "all", " ", "8", " ", 
             "parameters", " ", 
             RowBox[{"(", 
              RowBox[{
              "angles", " ", "and", " ", "speed", " ", "for", " ", "each", 
               " ", "wheel"}], ")"}], " ", "and", " ", "then", " ", "draw", 
             " ", "the", " ", "values", " ", "on", " ", "the", " ", 
             RowBox[{"graphcis", "."}]}], "*)"}], 
           RowBox[{"comDrawCalculations", "[", 
            RowBox[{"posBody", ",", "rotBody", ",", 
             RowBox[{"If", "[", 
              RowBox[{"b1", ",", 
               RowBox[{
                RowBox[{"-", "0.001"}], "posCurveCenter"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{"b2", ",", 
                 RowBox[{"0.001", "posCurveCenter"}], ",", "posCurveCenter"}],
                 "]"}]}], "]"}]}], "]"}]}], "}"}], ",", "comBackground", ",", 
         RowBox[{"PlotLabel", "\[Rule]", "distance"}]}], "]"}]}], "}"}], 
     "]"}], "\n", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"distance", ">", "0.001"}], "&&", "recordMoves"}], ",", 
      RowBox[{"WriteString", "[", 
       RowBox[{"stream", ",", 
        RowBox[{
         RowBox[{"StringTake", "[", 
          RowBox[{
           RowBox[{"ToString", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"AbsoluteTime", "[", "]"}], "-", "startTime"}], ",", 
              "distance", ",", "speedFrontRight", ",", "speedBackRight", ",", 
              "speedFrontLeft", ",", "speedBackLeft", ",", "angleFrontRight", 
              ",", "angleBackRight", ",", "angleFrontLeft", ",", 
              "angleBackLeft"}], "}"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", 
             RowBox[{"-", "2"}]}], "}"}]}], "]"}], "<>", "\"\<\\n\>\""}]}], 
       "]"}]}], "]"}]}]}], "\n", "]"}]], "Input",
 CellChangeTimes->{{3.759210556478448*^9, 3.759210708252303*^9}, {
   3.7592107444980464`*^9, 3.759210763644208*^9}, {3.7592108334213753`*^9, 
   3.759210833697583*^9}, 3.7592109751863513`*^9, {3.759211166780079*^9, 
   3.7592111939792356`*^9}, {3.759211307656867*^9, 3.759211427077297*^9}, {
   3.7592115784461145`*^9, 3.7592116358281317`*^9}, {3.759223908158055*^9, 
   3.759223950699969*^9}, {3.7592300246137047`*^9, 3.759230042043106*^9}, {
   3.7592301403321657`*^9, 3.7592301877726107`*^9}, {3.759230431709218*^9, 
   3.7592304392283115`*^9}, {3.759230476356307*^9, 3.7592304807717314`*^9}, {
   3.759231017708313*^9, 3.759231022413861*^9}, {3.7592343395564404`*^9, 
   3.7592343676189933`*^9}, {3.759234443397047*^9, 3.7592344607716827`*^9}, {
   3.759234950556573*^9, 3.7592350265874453`*^9}, {3.7592350676443434`*^9, 
   3.759235104651331*^9}, {3.759235479628928*^9, 3.7592354839954596`*^9}, {
   3.759235868061096*^9, 3.759235882972619*^9}, {3.759235918332074*^9, 
   3.7592360209470263`*^9}, {3.759236060846434*^9, 3.7592360810543427`*^9}, {
   3.7592362017367296`*^9, 3.759236264403895*^9}, {3.759236348957012*^9, 
   3.7592365596644745`*^9}, {3.759237172119695*^9, 3.75923718328622*^9}, {
   3.759237383108845*^9, 3.759237387957286*^9}, {3.759238055209771*^9, 
   3.7592380612829547`*^9}, 3.7592398682164564`*^9, {3.7592402531320963`*^9, 
   3.7592403318356824`*^9}, {3.75924036824971*^9, 3.759240369748886*^9}, {
   3.75924043990628*^9, 3.7592404483367662`*^9}, 3.7592404928433313`*^9, {
   3.759240563768467*^9, 3.759240564237058*^9}, {3.7592408568064747`*^9, 
   3.759240880564267*^9}, {3.7592409579269075`*^9, 3.75924099446249*^9}, {
   3.7592411318928237`*^9, 3.7592411322608027`*^9}, {3.759241238118441*^9, 
   3.7592412449873824`*^9}, {3.7592415193678093`*^9, 
   3.7592416721745787`*^9}, {3.7592417636483107`*^9, 3.759241767307543*^9}, {
   3.759241849480682*^9, 3.7592418508072824`*^9}, {3.7592418974320116`*^9, 
   3.7592419927493873`*^9}, {3.7592420255378695`*^9, 
   3.7592420293989215`*^9}, {3.7592420681753683`*^9, 
   3.7592420861176443`*^9}, {3.7592432686953244`*^9, 3.7592433123723016`*^9}, 
   3.75924340873435*^9, {3.7592439980256433`*^9, 3.7592439992270103`*^9}, {
   3.759244052219767*^9, 3.7592440733138533`*^9}, {3.7592445060049286`*^9, 
   3.7592445206634135`*^9}, {3.7592453443035316`*^9, 3.759245482235781*^9}, 
   3.759323809949156*^9, {3.7593239220946198`*^9, 3.7593239440731897`*^9}, {
   3.7593242228367186`*^9, 3.7593242604430203`*^9}, {3.7593772373313065`*^9, 
   3.759377262023157*^9}, {3.759378073562419*^9, 3.7593780920644503`*^9}, {
   3.759378164822348*^9, 3.7593781664483385`*^9}, {3.759380393770523*^9, 
   3.75938042998403*^9}, 3.759381220318223*^9, {3.759383316171155*^9, 
   3.7593833488212724`*^9}, 3.759383465438633*^9, {3.7593845122150974`*^9, 
   3.759384669908424*^9}, {3.7593847245009837`*^9, 3.7593848300495253`*^9}, {
   3.759384863868933*^9, 3.759384867044836*^9}, {3.759384905591957*^9, 
   3.759385044941331*^9}, 3.759385089344422*^9, {3.7593851452838926`*^9, 
   3.759385148560294*^9}, {3.75938629113869*^9, 3.7593863418126106`*^9}, {
   3.7593864711500664`*^9, 3.759386482934337*^9}, {3.7593865638965*^9, 
   3.7593866705753493`*^9}, {3.759386722746483*^9, 3.759386740839574*^9}, 
   3.759387392750205*^9, 3.759387549964859*^9, {3.759387773607343*^9, 
   3.7593877934467893`*^9}, {3.7593879049733143`*^9, 3.759387913958396*^9}, {
   3.7593881886920443`*^9, 3.7593882112200756`*^9}, {3.7593978245230565`*^9, 
   3.7593978581589413`*^9}, {3.7593979039108944`*^9, 
   3.7593979297563496`*^9}, {3.7593980414976225`*^9, 
   3.7593980420090466`*^9}, {3.7594018324637394`*^9, 3.7594018687348256`*^9}, 
   3.759402501089511*^9, {3.759402628630288*^9, 3.7594026782374673`*^9}, {
   3.759402732729473*^9, 3.759402734159338*^9}, {3.7594028631123357`*^9, 
   3.7594028678527884`*^9}, {3.7594034346408415`*^9, 
   3.7594034397872744`*^9}, {3.759403528517415*^9, 3.7594035583439755`*^9}, {
   3.759404479626338*^9, 3.759404483401533*^9}, {3.7594045330642896`*^9, 
   3.7594045654235907`*^9}, {3.7594046838416734`*^9, 
   3.7594046852744193`*^9}, {3.7594048078522096`*^9, 
   3.7594048339875865`*^9}, {3.7594048717928977`*^9, 3.759404884258397*^9}, {
   3.759404963275344*^9, 3.7594049772302046`*^9}, {3.7594062126944876`*^9, 
   3.7594062325912304`*^9}, {3.7594064980593023`*^9, 3.759406538830751*^9}, 
   3.7594066031530285`*^9, {3.7594070282581654`*^9, 3.7594070412194448`*^9}, {
   3.759407504202648*^9, 3.7594075250509834`*^9}, {3.759407620994693*^9, 
   3.7594078044885163`*^9}, {3.7594078859649754`*^9, 3.759407953492075*^9}, 
   3.7594080113493395`*^9, {3.759408052772727*^9, 3.7594080594144163`*^9}, {
   3.7594081451843114`*^9, 3.75940815037956*^9}, {3.7602414004976373`*^9, 
   3.7602414539374313`*^9}, {3.7602421096692305`*^9, 3.7602421166417837`*^9}, 
   3.7602422322594156`*^9, 3.7602450712285385`*^9, {3.7602648530500884`*^9, 
   3.760264856177186*^9}, {3.7602648897606983`*^9, 3.760265190064704*^9}, {
   3.760265242517746*^9, 3.7602652607630453`*^9}, {3.760265311229903*^9, 
   3.7602653248919454`*^9}, {3.7602653561189637`*^9, 
   3.7602653816091146`*^9}, {3.760265422550271*^9, 3.760265548471512*^9}, {
   3.7602655831350694`*^9, 3.760265593205412*^9}, {3.760265686563466*^9, 
   3.7602659597136407`*^9}, {3.7602660107065864`*^9, 
   3.7602660794740257`*^9}, {3.7602661175652356`*^9, 
   3.7602661204678793`*^9}, {3.760266210130821*^9, 3.7602662723477545`*^9}, {
   3.760266345263536*^9, 3.7602664481639757`*^9}, {3.760266618601466*^9, 
   3.760266644314125*^9}, {3.760266675940345*^9, 3.7602669265687475`*^9}, {
   3.7602671629202695`*^9, 3.7602673469973307`*^9}, 3.760268362563854*^9, {
   3.7602684777364845`*^9, 3.7602685169383807`*^9}, 3.7603106992849054`*^9, {
   3.760310765759156*^9, 3.7603107862512064`*^9}, {3.7603118625228434`*^9, 
   3.760311870273239*^9}, {3.7603119157596045`*^9, 3.760311918891554*^9}, {
   3.760312701568949*^9, 3.7603127680822372`*^9}, {3.760534476901552*^9, 
   3.7605344807598596`*^9}, {3.760534549980487*^9, 3.760534629458069*^9}, {
   3.760534681765873*^9, 3.7605346886645527`*^9}, {3.7605347967189507`*^9, 
   3.760534807529976*^9}, {3.760534856308134*^9, 3.7605351602180605`*^9}, {
   3.7605352093771477`*^9, 3.7605353790988235`*^9}, {3.7605395125338097`*^9, 
   3.7605395504681163`*^9}},
 CellLabel->
  "In[241]:=",ExpressionUUID->"20b87acd-c749-4eef-b154-d2eeb273e5da"],

Cell[BoxData[
 DynamicBox[
  ToBoxes[{$CellContext`x1, $CellContext`y1, $CellContext`z1, \
$CellContext`x2, $CellContext`y2, $CellContext`z2} = $CellContext`factor (
      ControllerState[
       "SpaceNavigator", {
        "X1", "Y1", "Z1", "X2", "Y2", 
         "Z2"}] - $CellContext`latest); {$CellContext`b1, $CellContext`b2} = 
    ControllerState[
     "SpaceNavigator", {"B1", "B2"}]; $CellContext`posBodyHistory = 
    RotateRight[$CellContext`posBodyHistory]; 
   Part[$CellContext`posBodyHistory, 
      1] = {$CellContext`x1, $CellContext`y1}; {$CellContext`dx, \
$CellContext`dy} = 
    RotationTransform[$CellContext`rotBody][
     Part[$CellContext`posBodyHistory, 1] - 
      Part[$CellContext`posBodyHistory, 2]]; $CellContext`distance = 
    Norm[{$CellContext`dx, $CellContext`dy}]; $CellContext`bodyRadius = 
    Norm[$CellContext`posCurveCenter]; $CellContext`dTheta = 
    Sign[$CellContext`z2] ($CellContext`distance/$CellContext`bodyRadius); \
$CellContext`theta = Apply[ArcTan, $CellContext`posCurveCenter]; 
   AddTo[$CellContext`posBody, (-
      Sign[$CellContext`z2]) $CellContext`distance {-Sin[$CellContext`theta], 
       Cos[$CellContext`theta]}]; 
   AddTo[$CellContext`rotBody, $CellContext`dTheta]; 
   If[$CellContext`b1, AddTo[$CellContext`rotBody, 0.05]; Null]; 
   If[$CellContext`b2, SubtractFrom[$CellContext`rotBody, 0.05]; Null]; 
   If[$CellContext`distance < 
     0.01, $CellContext`dirBody = $CellContext`dirBodyLast, \
$CellContext`dirBody = ($CellContext`dirBodyLast = {$CellContext`dx, \
$CellContext`dy})]; $CellContext`rotBodyDirectionAngle = 
    Apply[ArcTan, $CellContext`dirBody] + Pi/2 + 
     Pi; $CellContext`posCurveCenter = 
    If[-$CellContext`zeroRange < $CellContext`z2 < $CellContext`zeroRange, 
      RotationTransform[$CellContext`rotBodyDirectionAngle, {0, 0}][{10000, 
       0}], 
      RotationTransform[$CellContext`rotBodyDirectionAngle, {0, 
       0}][{(-1)/$CellContext`z2, 0}]]; Column[{
       Row[{
         Button[
         "Start Recording", $CellContext`startTime = 
           AbsoluteTime[]; $CellContext`recordMoves = 
           True; $CellContext`fname = FileNameJoin[{
              NotebookDirectory[], "testfile.csv"}]; $CellContext`stream = 
           OpenWrite[$CellContext`fname]; 
          WriteString[$CellContext`stream, 
            "Time, Center Speed, Front Right Speed, Back Right Speed, Front \
Left Speed, Back Left Speed, Front Right Angle,\n\tBack Right Angle, Front \
Left Angle, Back Left Angle\n"]; Null], 
         Button[
         "Stop and Save", $CellContext`recordMoves = False; 
          Close[$CellContext`stream]]}], 
       Graphics[{
         $CellContext`comCar[$CellContext`posBody, $CellContext`rotBody], 
         $CellContext`comWheels[$CellContext`posBody, $CellContext`rotBody, 
          If[$CellContext`b1, (-0.001) $CellContext`posCurveCenter, 
           
           If[$CellContext`b2, 
            0.001 $CellContext`posCurveCenter, $CellContext`posCurveCenter]]], 
         $CellContext`comDrawCircles[$CellContext`posBody, \
$CellContext`rotBody, 
          If[$CellContext`b1, (-0.001) $CellContext`posCurveCenter, 
           
           If[$CellContext`b2, 
            0.001 $CellContext`posCurveCenter, $CellContext`posCurveCenter]]], 
         $CellContext`comDrawCalculations[$CellContext`posBody, \
$CellContext`rotBody, 
          If[$CellContext`b1, (-0.001) $CellContext`posCurveCenter, 
           
           If[$CellContext`b2, 
            0.001 $CellContext`posCurveCenter, \
$CellContext`posCurveCenter]]]}, $CellContext`comBackground, 
        PlotLabel -> $CellContext`distance]}] If[
      And[$CellContext`distance > 0.001, $CellContext`recordMoves], 
      WriteString[$CellContext`stream, 
       StringJoin[
        StringTake[
         ToString[{
          AbsoluteTime[] - $CellContext`startTime, $CellContext`distance, \
$CellContext`speedFrontRight, $CellContext`speedBackRight, \
$CellContext`speedFrontLeft, $CellContext`speedBackLeft, \
$CellContext`angleFrontRight, $CellContext`angleBackRight, \
$CellContext`angleFrontLeft, $CellContext`angleBackLeft}], {2, -2}], "\n"]]], 
   StandardForm],
  ImageSizeCache->{834., {419.5, 425.5}}]], "Output",
 CellChangeTimes->{
  3.759398044785774*^9, 3.759398681132901*^9, 3.759398766245943*^9, 
   3.7593987996319733`*^9, {3.7593988574511895`*^9, 3.759398863994295*^9}, 
   3.759398935331109*^9, {3.759399007557062*^9, 3.759399017132598*^9}, 
   3.7594019123053207`*^9, 3.759402023301927*^9, 3.759402201749832*^9, 
   3.759402259004922*^9, {3.7594025052023735`*^9, 3.7594025317866883`*^9}, 
   3.759402679302285*^9, 3.759402735649665*^9, 3.759402868845366*^9, 
   3.759403112673868*^9, 3.7594031467333403`*^9, 3.759403562409014*^9, 
   3.7594036877639933`*^9, 3.759404004513423*^9, 3.7594042691812162`*^9, 
   3.7594043780920815`*^9, 3.7594044865705786`*^9, 3.7594045657329817`*^9, 
   3.7594046201693645`*^9, 3.7594046867315865`*^9, 3.7594047695461626`*^9, {
   3.759404810178019*^9, 3.759404822052062*^9}, {3.75940485827923*^9, 
   3.759404884792244*^9}, 3.759405053826679*^9, 3.7594054404920435`*^9, 
   3.759405521318528*^9, 3.759405570513788*^9, 3.759405675636803*^9, 
   3.759405748444598*^9, 3.759406234736451*^9, 3.759406541327362*^9, {
   3.75940661799994*^9, 3.7594066202017975`*^9}, {3.759407030881637*^9, 
   3.7594070441142673`*^9}, 3.7594071602397146`*^9, 3.759407531988372*^9, {
   3.759407628106824*^9, 3.759407657998724*^9}, 3.759407691971305*^9, 
   3.7594077711844463`*^9, 3.759407805236107*^9, 3.759407963918683*^9, 
   3.759408013851798*^9, 3.759408061979377*^9, 3.759408151703992*^9, 
   3.7599728366405506`*^9, 3.7602412860814314`*^9, 3.7602414559723964`*^9, 
   3.7602421175474825`*^9, {3.7602425752982225`*^9, 3.7602425958537035`*^9}, 
   3.760244989993851*^9, 3.760267223290578*^9, 3.7602673536272545`*^9, 
   3.7602687338099675`*^9, {3.7602688949999037`*^9, 3.760268902909376*^9}, {
   3.760268957410082*^9, 3.7602689655362372`*^9}, {3.760310819061289*^9, 
   3.760310822152301*^9}, 3.760311881353709*^9, 3.760311920693261*^9, {
   3.7605344719521236`*^9, 3.7605344817240276`*^9}, {3.760534615647539*^9, 
   3.760534630259742*^9}, 3.7605395705405307`*^9, 3.760539629445904*^9, 
   3.760571945549247*^9},
 CellLabel->
  "Out[241]=",ExpressionUUID->"bef7e98b-897c-4d7a-a089-6d9d8eee6c7d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "[", 
  RowBox[{"{", 
   RowBox[{"z2", ",", "posCurveCenter"}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.7602664672144623`*^9, 3.760266536790415*^9}, {
  3.7602693242202525`*^9, 3.760269337007778*^9}},
 CellLabel->
  "In[242]:=",ExpressionUUID->"255cca4d-2bc0-4995-9384-cb38120ce8fb"],

Cell[BoxData[
 DynamicBox[
  ToBoxes[{$CellContext`z2, $CellContext`posCurveCenter}, StandardForm],
  ImageSizeCache->{226., {6., 12.}}]], "Output",
 CellChangeTimes->{{3.760266485378764*^9, 3.7602665375028667`*^9}, 
   3.760269340032365*^9, 3.7605395712189817`*^9, 3.760539629648922*^9, 
   3.760571945729818*^9},
 CellLabel->
  "Out[242]=",ExpressionUUID->"c5b42772-7c80-4541-983c-57e41f665298"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "@", "distance"}]], "Input",
 CellChangeTimes->{{3.760309723817566*^9, 3.7603097341090126`*^9}},
 CellLabel->
  "In[243]:=",ExpressionUUID->"650b5d59-a959-4fed-a2c2-5e83c35b64f0"],

Cell[BoxData[
 DynamicBox[ToBoxes[$CellContext`distance, StandardForm],
  ImageSizeCache->{14., {0., 8.}}]], "Output",
 CellChangeTimes->{3.760309727618572*^9, 3.760539571656117*^9, 
  3.7605396298144464`*^9, 3.760571945897791*^9},
 CellLabel->
  "Out[243]=",ExpressionUUID->"a5ab9c2c-aa6f-4f28-b386-1141ee61c6f0"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
NotebookAutoSave->True,
WindowSize->{1113, 1823},
WindowMargins->{{Automatic, 161}, {Automatic, 254}},
FrontEndVersion->"11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 5, \
2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 283, 4, 98, "Title",ExpressionUUID->"7c9512d1-d4da-48ef-8c98-e1e558668319"],
Cell[CellGroupData[{
Cell[888, 30, 223, 5, 45, "Subsubsection",ExpressionUUID->"e289b838-1f19-4e70-b73d-f36ad49c95d0"],
Cell[1114, 37, 12128, 228, 619, "Input",ExpressionUUID->"943c82f4-b51b-42dd-8f4a-d6bf64d720a1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13279, 270, 195, 3, 45, "Subsubsection",ExpressionUUID->"6f7be653-ad4b-43a1-be94-08955238cb1f"],
Cell[CellGroupData[{
Cell[13499, 277, 28100, 573, 1774, "Input",ExpressionUUID->"20b87acd-c749-4eef-b154-d2eeb273e5da"],
Cell[41602, 852, 6323, 115, 864, "Output",ExpressionUUID->"bef7e98b-897c-4d7a-a089-6d9d8eee6c7d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[47962, 972, 323, 7, 28, "Input",ExpressionUUID->"255cca4d-2bc0-4995-9384-cb38120ce8fb"],
Cell[48288, 981, 397, 8, 36, "Output",ExpressionUUID->"c5b42772-7c80-4541-983c-57e41f665298"]
}, Open  ]],
Cell[CellGroupData[{
Cell[48722, 994, 213, 4, 28, "Input",ExpressionUUID->"650b5d59-a959-4fed-a2c2-5e83c35b64f0"],
Cell[48938, 1000, 314, 6, 32, "Output",ExpressionUUID->"a5ab9c2c-aa6f-4f28-b386-1141ee61c6f0"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

